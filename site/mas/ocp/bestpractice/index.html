<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://ibm-mas.github.io/mas-performance/mas/ocp/bestpractice/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>OpenShift Container Platform - Maximo Application Suite (MAS) Performance Wiki</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "OpenShift Container Platform";
        var mkdocs_page_input_path = "mas/ocp/bestpractice.md";
        var mkdocs_page_url = "/mas-performance/mas/ocp/bestpractice/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/yaml.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> Maximo Application Suite (MAS) Performance Wiki
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">MAS</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Best Practice</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="./">OpenShift Container Platform</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#cluster-insights-advisor">Cluster Insights Advisor</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#pid-limit-for-docker">PID limit for docker</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#haproxy-router">HAProxy Router</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#ingress-controller">Ingress Controller</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#max-connection">Max Connection</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#load-balance-algorithm">Load Balance Algorithm</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../core/bestpractice/">MAS Core</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../iot/bestpractice/">MAS IoT</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../manage/bestpractice/">MAS Manage</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../aws/bestpractice/">AWS</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../ibmcloud/bestpractice/">IBM Cloud</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../mongodb/bestpractice/">MongoDB</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../sizing/guidance/">Sizing Guidance</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../monitoring/guidance/">Monitoring</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Maximo 7.x</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../maximo-7/bestpractice/">Best Practice</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Performance Diagnosis</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../pd/ptbp/">Performance Test Best Practice</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../pd/checklist/">Diagnosis Check List</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../pd/db2-performance-diagnosis/">DB2 Performance Diagnosis</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">Maximo Application Suite (MAS) Performance Wiki</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>MAS &raquo;</li>
          <li>Best Practice &raquo;</li>
      <li>OpenShift Container Platform</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/ibm-mas/mas-performance/blob/master/docs/mas/ocp/bestpractice.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="openshift-container-platform">OpenShift Container Platform<a class="headerlink" href="#openshift-container-platform" title="Permanent link"></a></h1>
<h2 id="cluster-insights-advisor">Cluster Insights Advisor<a class="headerlink" href="#cluster-insights-advisor" title="Permanent link"></a></h2>
<p>Highly recommend to use OpenShift cluster Insights Advisor that to check for any issue related to the current version, nodes and mis-configurations. It is the first step for the problem diagnosis. </p>
<p>Steps:</p>
<ul>
<li>Login on OpenShift Console</li>
<li>Go to Administration -&gt; Cluster Settings</li>
<li>Click OpenShift Cluster Manager in Subscription section. It redirects the url to RedHat Hybrid Cloud Console</li>
<li>Click Insights Advisor</li>
</ul>
<h2 id="pid-limit-for-docker">PID limit for docker<a class="headerlink" href="#pid-limit-for-docker" title="Permanent link"></a></h2>
<p>This settings control how many processes can be run within one single container. If it is too small, it can cause folk bomb issue. E.g. db2w instance may be unavailable when there are thousands of connections/agents upcoming or Openshift Container Storage not behaving well with a large amount of PVCs. </p>
<p><strong>OOB value for OCP platforms:</strong></p>
<table>
<thead>
<tr>
<th>Platform Version</th>
<th>Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>IBM ROKS (4.8)</td>
<td>231239</td>
</tr>
<tr>
<td>AWS ROSA</td>
<td>1024 (Not Specified)</td>
</tr>
<tr>
<td>Azure Self-Managed OCP</td>
<td>1024</td>
</tr>
</tbody>
</table>
<p><strong>Steps to check or update PID limit:</strong>
<div class="highlight"><pre><span></span><code>$ oc debug node/$NODE_NAME
$ chroot /host
$ cat /etc/crio/crio.conf
# add / modify the line &quot;pids_limit = &lt;new value&gt;&quot;
# run belows commands to reboot services and worker nodes
$ systemctl daemon-reload
$ systemctl restart crio
$ shutdown -r now
</code></pre></div></p>
<h2 id="haproxy-router">HAProxy Router<a class="headerlink" href="#haproxy-router" title="Permanent link"></a></h2>
<h3 id="ingress-controller">Ingress Controller<a class="headerlink" href="#ingress-controller" title="Permanent link"></a></h3>
<p>Openshift HAProxy supports up to 20k connections per pod. Consider to scale up ingress pod for any app (like IoT) with a high volume connection workload. </p>
<p><strong>Scale up ingress controller</strong></p>
<ul>
<li><strong>command:</strong>  <code>oc patch -n openshift-ingress-operator ingresscontroller/default --patch '{"spec":{"replicas": 3}}' --type=merge</code></li>
</ul>
<h3 id="max-connection">Max Connection<a class="headerlink" href="#max-connection" title="Permanent link"></a></h3>
<p>One of the most important tunable parameters for HAProxy scalability is the <code>maxconn</code> parameter. The router can handle a maximum number of 20k concurrent connections by using <code>oc adm router --max-connections=xxxxx</code>. This parameter will be impacted by node settings <code>sysctl fs.nr_open</code> and <code>sysctl fs.file-max</code>. HAproxy will not start if maxconn is high, but node setting is low. </p>
<p><strong>Note:</strong> OpenShift Container Platform <strong>no longer</strong> supports modifying Ingress Controller deployments by setting environment variables such as ROUTER_THREADS, ROUTER_DEFAULT_TUNNEL_TIMEOUT, ROUTER_DEFAULT_CLIENT_TIMEOUT, ROUTER_DEFAULT_SERVER_TIMEOUT, and RELOAD_INTERVAL. You can modify the Ingress Controller deployment, but if the Ingress Operator is enabled, the configuration is overwritten.</p>
<h3 id="load-balance-algorithm">Load Balance Algorithm<a class="headerlink" href="#load-balance-algorithm" title="Permanent link"></a></h3>
<p>There are 3 load-balancing algorithms: <strong>source, roundrobin, and leastconn</strong> (default: leastconn). Set up annotations for each route to change the default algorithm. e.g. <code>haproxy.router.openshift.io/balance=roundrobin</code></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ibm-mas/mas-performance" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../../.." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../core/bestpractice/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
